## Middleware

Middleware — это промежуточный слой между веб-сервером и приложением, который 
 
* обрабатывать HTTP-запросы до того, как они достигнут обработчика (view/route),
* обрабатывать HTTP-ответы перед отправкой их клиенту,
* изменять или добавлять информацию в запрос/ответ (например, заголовки, куки, сессии, авторизацию и т.д.).

Как видим, Middleware может делать многое. 
Но, применительно к нашей теме, особенно важно, что Middleware
 - извлекает сессионный ключ из HTTP-запроса
 - и связывает его с зарегистрированным или абстрактными пользователем.

### Основное – `AuthenticationMiddleware`:

* Это стандартный middleware Django, который добавляет объект `user` к каждому HTTP-запросу (`request.user`).
* Если пользователь аутентифицирован, `request.user` будет экземпляром `User` (или кастомного пользователя). 
  Если нет — `request.user` будет объектом `AnonymousUser`.
* Благодаря этому во views можно легко проверять права доступа, группы и другие атрибуты пользователя.

### Работает в связке с `SessionMiddleware`:

* `AuthenticationMiddleware` сам по себе не может определять пользователя. 
* Он использует сессии для хранения информации о том, кто вошёл в систему.
* Поэтому **`SessionMiddleware` должен быть подключен раньше**. 
* Без него `request.user` всегда будет `AnonymousUser`, даже если пользователь реально вошёл в систему.

### Итого:

Middleware аутентификации обеспечивает прозрачное взаимодействие между системой пользователей и запросами к приложению.

Что позволяет во views и шаблонах легко получить текущего пользователя и управлять его доступам к ресурсам сервера.


