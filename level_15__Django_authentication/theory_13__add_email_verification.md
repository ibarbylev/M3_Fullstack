## Общая идея верификации пользователя

### 1. `user.is_active` (поле встроенной модели `User`)

* Исторически задумывалось как флаг "может ли пользователь входить в систему".
* Если `is_active=False`, то пользователь не сможет авторизоваться через стандартные механизмы Django  
  (`authenticate`, `LoginView` и т.д.).
* Обычно используют для:

  * Блокировки пользователей (бан).
  * Подтверждения email (чтобы пользователь не мог войти, пока не кликнет по ссылке).
* Проверяется автоматически внутри `django.contrib.auth`.

---

### 2. `profile.is_verified` (наше расширение в `UserProfile`)

* Это **наш кастомный флаг** для бизнес-логики.
* Он нужен, чтобы различать пользователей:

  * Подтвержден почтовый адрес или нет.
  * Можно ли доверять телефону, документам и т.п.
* Не влияет напрямую на возможность логина.

---

### Зачем использовать оба?

* **Простой способ** — использовать только `profile.is_verified`, а `user.is_active` оставить всегда `True`.

  * Минус: придётся везде самим проверять `profile.is_verified` (например, в middleware, вьюхах, декораторах).
* **Более надёжный способ** — при регистрации ставить `user.is_active=False`.

  * До подтверждения email пользователь вообще не сможет войти.
  * После подтверждения → `is_active=True` и `profile.is_verified=True`.

---

### Резюме

* `user.is_active` — технический флаг, встроенный в Django. Удобно использовать для "жёсткой блокировки" логина до подтверждения почты.
* `profile.is_verified` — ваш бизнес-флаг: показывает именно факт верификации email (или любых других данных).

---


## Схема верификации пользователя

```
[Пользователь] 
      │
      ▼
┌───────────────────────┐
│  Регистрация (форма)  │
└───────────────────────┘
      │
      ▼
┌────────────────────────────┐
│ Создать User (is_active=0) │
│ Создать/обновить профиль   │
│ Сгенерировать токен        │
└────────────────────────────┘
      │
      ▼
┌──────────────────────────────┐
│  Отправить "письмо" (print)  │
│   http://site/verify/uid/tk  │
└──────────────────────────────┘
      │
      ▼
[Пользователь кликает ссылку]
      │
      ▼
┌──────────────────────────────┐
│   VerifyEmailView (uid, tk)  │
└──────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│ Проверить токен и существование User │
└─────────────────────────────────────┘
      │
      ├── ❌ Недействительно → Ошибка
      │
      ▼
✅ Успешно
      │
      ▼
┌──────────────────────────────┐
│ user.is_active = True         │
│ profile.is_verified = True    │
└──────────────────────────────┘
      │
      ▼
[Пользователь может войти]
```

---

Таким образом:

1. При регистрации пользователь "заморожен" (`is_active=False`).
2. В консоль выводится "письмо" с ссылкой.
3. Пользователь переходит по ссылке → токен валиден → активируем аккаунт и отмечаем в профиле `is_verified=True`.


