## 2. `UserManager(BaseUserManager)` - менеджер модели `User`

Модель `User` хранит данные, поэтому она такая же, как и другие модели Django.

C другой стороны эта модель участвую в аутентификации / авторизации,  
поэтому её менеджер обладает собственными уникальными свойствами.

Поэтому менеджер модели `User` — не просто `models.Manager`,
а специализированный менеджер `BaseUserManager`.

#### `BaseUserManager` vs `models.Manager`

* `models.Manager`

  * это базовый класс всех менеджеров Django,
  * даёт доступ к ORM (`.all()`, `.filter()`, `.create()` и т.д.).
  * не имеет ничего специфичного для аутентификации или пользователей.

* `BaseUserManager`

  * наследуется от `models.Manager`,
  * расширяет его методами, полезными именно для модели пользователя:

    * `normalize_email`,
    * `make_random_password`,
    * заготовки для `create_user` и `create_superuser`.
  * при этом он остаётся менеджером Django (все `.filter()`, `.all()`, `.get()` продолжают работать).

---

#### Схема иерархии менеджеров моделей

```
models.Manager
       ↑
 BaseUserManager
       ↑
  UserManager
```

* `models.Manager` → общий менеджер для любых моделей.
* `BaseUserManager` → специализированный для моделей пользователей, но ещё абстрактный.
* `UserManager` → конкретная реализация для стандартного `User`.

---

### 3. Специальные методы `UserManager(BaseUserManager)`

### 3.1. Методы для создания пользователей в менеджере `UserManager`

   * `create_user(username, email=None, password=None, **extra_fields)`  
     Создаёт обычного пользователя: автоматически хэширует пароль,  
     нормализует email и сохраняет объект.

   * `create_superuser(username, email=None, password=None, **extra_fields)`  
     Создаёт суперпользователя (с флагами `is_staff=True`, `is_superuser=True`).

   Без этих методов вручную создавать пользователей было бы неудобно  
   (например, нельзя просто присвоить `password="123"` — нужно через хэширование).

### 2.2. Нормализация email

   Перед сохранением email приводится к стандартному виду (`normalize_email`).  
   Это гарантирует, что разные варианты написания (`Test@Mail.com` и `test@mail.com`)  
   будут рассматриваться как один и тот же адрес.

### 2.3. Интеграция с системой аутентификации

   `UserManager` используется внутри `django.contrib.auth`,  
   чтобы работать с командами `createsuperuser`, `changepassword`,  
   а также при вызове `django.contrib.auth.authenticate()`.

### 2.4. Гибкость для кастомных моделей
   Если вы создаёте **свою модель пользователя** (через `AbstractBaseUser`),  
   вам обязательно нужно написать **собственный менеджер**,  
   чтобы поддерживать `create_user` и `create_superuser`.  
   Без этого Django не сможет корректно работать с вашей моделью  
   (например, команда `createsuperuser` не заработает).

---

Таким образом, `UserManager` — это связующее звено между моделью пользователя и системой аутентификации Django.

Он отвечает не только за создание объектов, но и за то, чтобы они были корректными и безопасными   
c точки зрения аутентификации и авторизации.





