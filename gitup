#!/bin/bash

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
set -x  # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏

# üìù –£–∫–∞–∑—ã–≤–∞–µ–º URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
REPO_URL="git@github.com:ibarbylev/M3_Fullstack.git"

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫ —Ç–æ–º—É —É–¥–∞–ª—ë–Ω–Ω–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π
CURRENT_URL=$(git remote get-url origin 2>/dev/null)

if [ "$CURRENT_URL" = "$REPO_URL" ]; then
  echo "‚úÖ Remote origin —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ."
else
  echo "‚ùå Remote origin –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
  exit 1
fi

# 2. –ó–∞–ø—É—à–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
git pull

# 3. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π .git –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
rm -rf .git
git init

# 4. –î–æ–±–∞–≤–ª—è–µ–º –∏ –∫–æ–º–º–∏—Ç–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã
git add .
git commit -am "Initial commit"

# 5. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º origin –∏ –ø—É—à–∏–º —Å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é –∏—Å—Ç–æ—Ä–∏–∏
git remote add origin "$REPO_URL"
git push -u --force origin master  # –∏–ª–∏ main, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ main

# 6. –ù–µ –∑–∞–±—É–¥—å —Å–¥–µ–ª–∞—Ç—å —Ñ–∞–π–ª –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º!
# chmod +x gitup

