## –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞**

**`pytest-django`** ‚Äî —ç—Ç–æ –ø–ª–∞–≥–∏–Ω –¥–ª—è **pytest**, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Django-–ø—Ä–æ–µ–∫—Ç–æ–≤.

[https://pytest-django.readthedocs.io/en/latest/](https://pytest-django.readthedocs.io/en/latest/)

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

```bash
pip install pytest-django
```

---

## **–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**

–ü–∞–∫–µ—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç Django-—Ç–µ—Å—Ç—ã ‚Äî –æ–Ω –≥–ª—É–±–æ–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º:

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å                           | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                                                              |
| ------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| üîπ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django –æ–∫—Ä—É–∂–µ–Ω–∏—è**     | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç Django-—Å—Ä–µ–¥—É –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏ (`settings`, `INSTALLED_APPS`, `DATABASES` –∏ —Ç.–¥.)   |
| üîπ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ORM**               | –°–æ–∑–¥–∞—ë—Ç –∏ –æ—á–∏—â–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö; –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ORM –Ω–∞–ø—Ä—è–º—É—é (–º–æ–¥–µ–ª–∏, –∑–∞–ø—Ä–æ—Å—ã, –º–∏–≥—Ä–∞—Ü–∏–∏) |
| üîπ **–§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è Django**            | –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã (`db`, `transactional_db`, `client`, `admin_client`, `rf` –∏ —Ç.–¥.)        |
| üîπ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ DRF**                  | –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å REST API —á–µ—Ä–µ–∑ `APIClient`, `APIRequestFactory`, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –∏ –≤—å—é—Ö–∏                |
| üîπ **–†–∞–±–æ—Ç–∞ —Å settings**              | –ß–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—É `settings` –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Django –≤ —Ç–µ—Å—Ç–∞—Ö                          |
| üîπ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å pytest-plugins** | –†–∞–±–æ—Ç–∞–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏ pytest (`pytest-cov`, `pytest-xdist`, `pytest-mock` –∏ –¥—Ä.)                 |

---

## –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å –ø–æ–º–æ—â—å—é `pytest-django`?`

### Django-—á–∞—Å—Ç—å:

* **–ú–æ–¥–µ–ª–∏ –∏ ORM:**

  * —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—é, –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ;
  * —Å–∏–≥–Ω–∞–ª—ã (`post_save`, `pre_delete` –∏ —Ç.–¥.);
  * –∑–∞–ø—Ä–æ—Å—ã –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é (`Model.objects.filter(...)`).

* **–§–æ—Ä–º—ã –∏ —à–∞–±–ª–æ–Ω—ã:**

  * –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞;
  * –∫–æ–Ω—Ç–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–æ–≤, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ HTML.

* **Views –∏ middleware:**

  * –æ—Ç–≤–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (`client.get()`, `client.post()` –∏ —Ç.–ø.);
  * —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã, –∫–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤, –∫–æ–Ω—Ç–µ–∫—Å—Ç.

* **–ê–¥–º–∏–Ω–∫–∞:**

  * –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º, CRUD —á–µ—Ä–µ–∑ `admin_client`.

---

### DRF-—á–∞—Å—Ç—å:

* –ü—Ä–æ–≤–µ—Ä—è—Ç—å **—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API** —á–µ—Ä–µ–∑ `APIClient`:
* –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å **—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã**:
* –ü—Ä–æ–≤–µ—Ä—è—Ç—å **–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**, **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é** –∏ **—Ñ–∏–ª—å—Ç—Ä—ã**.
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `APIRequestFactory` –¥–ª—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª **`pytest.ini`** –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```ini
[pytest]
DJANGO_SETTINGS_MODULE = myproject.settings
python_files = tests.py test_*.py *_tests.py
addopts = --reuse-db
```

üî∏ `DJANGO_SETTINGS_MODULE` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞; —É–∫–∞–∑—ã–≤–∞–µ—Ç, –≥–¥–µ –≤–∑—è—Ç—å `settings.py`.

üî∏ `python_files` ‚Äî —à–∞–±–ª–æ–Ω –∏–º–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤.

üî∏ `--reuse-db` ‚Äî —É—Å–∫–æ—Ä—è–µ—Ç —Ç–µ—Å—Ç—ã, –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—è –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ —Å—Ö–µ–º–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å).

---

## –§–∏–∫—Å—Ç—É—Ä—ã –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —Ç–µ—Å—Ç–æ–≤

`pytest-django` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ **—Ñ–∏–∫—Å—Ç—É—Ä—ã** (—Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏):

| –§–∏–∫—Å—Ç—É—Ä–∞                                | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                      |
| --------------------------------------- | ------------------------------------------------------------------------------- |
| `db`                                    | –ü–æ–¥–∫–ª—é—á–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö; –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞                          |
| `transactional_db`                      | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏; –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –≥–¥–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `client`                                | Django-—Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç (–∏–º–∏—Ç–∞—Ü–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤)                                 |
| `admin_client`                          | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞                                   |
| `rf`                                    | `RequestFactory` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤ views                 |
| `settings`                              | –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è—Ç—å `settings`                                            |
| `django_user_model`                     | –î–æ—Å—Ç—É–ø –∫ –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Custom User)                                      |
| `django_db_setup` / `django_db_blocker` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ë–î –≤—Ä—É—á–Ω—É—é                                                 |

---

## –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç –º–æ–¥–µ–ª–∏:

```python
import pytest
from myapp.models import Book

@pytest.mark.django_db
def test_book_creation():
    book = Book.objects.create(title="Pytest Guide")
    assert Book.objects.count() == 1
    assert book.title == "Pytest Guide"
```

### –¢–µ—Å—Ç view:

```python
@pytest.mark.django_db
def test_index_view(client):
    response = client.get('/')
    assert response.status_code == 200
    assert b"Welcome" in response.content
```

### –¢–µ—Å—Ç DRF API:

```python
from rest_framework.test import APIClient

@pytest.mark.django_db
def test_books_api():
    client = APIClient()
    response = client.get('/api/books/')
    assert response.status_code == 200
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã `settings`:

```python
def test_debug_is_false(settings):
    settings.DEBUG = False
    assert not settings.DEBUG
```

---

## ‚ö° **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**

* **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è:**

  ```python
  @pytest.mark.parametrize('title', ['One', 'Two'])
  def test_create_books(title):
      book = Book.objects.create(title=title)
      assert book.title == title
  ```

* **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mock:**

  ```python
  from unittest.mock import patch

  @patch('myapp.views.send_email')
  def test_send_email(mock_send, client):
      client.post('/contact/', {'name': 'Test'})
      mock_send.assert_called_once()
  ```

