Подводим кратки итог того, что уже знаем (или почти знаем):

1. **Простая форма** (`ModelForm`) → для одного объекта модели.
2. **Инлайн-форма** (`InlineFormSet`) → для связанных объектов (обычно *ForeignKey*), редактируем их на одной странице вместе с родителем.
3. **Набор форм модели** (`ModelFormSet`) → для нескольких **объектов одной и той же модели** без привязки к родителю.


### **Основная идея ModelFormSet**

ModelFormSet — это набор форм (`FormSet`), каждая из которых — `ModelForm` для отдельного экземпляра одной модели.
Можно массово:

* отображать список объектов,
* изменять их значения,
* сохранять всё одной кнопкой.

По сути, с помощью `FormSet` мы превращаем обычную таблицу БД в электронную таблицу по типу Excel.

---

## Сравнение с предыдущими вариантами

| Подход            | Что редактируем                 | Когда использовать                                                      | Связь между объектами  |
| ----------------- | ------------------------------- | ----------------------------------------------------------------------- | ---------------------- |
| **ModelForm**     | Один объект                     | Создание/редактирование одного экземпляра                               | Нет                    |
| **InlineFormSet** | Дочерние объекты родителя       | Когда есть ForeignKey, и нужно редактировать «детей» вместе с родителем | Есть (родитель → дети) |
| **ModelFormSet**  | Несколько объектов одной модели | Массовое редактирование без привязки к родителю                         | Нет                    |

---

## Пример: массовое редактирование книг

```python
from django.forms import modelformset_factory
from django.shortcuts import render, redirect
from .models import Book

def edit_books(request):
    BookFormSet = modelformset_factory(Book, fields=('title', 'price'), extra=0)

    if request.method == "POST":
        formset = BookFormSet(request.POST)
        if formset.is_valid():
            formset.save()
            return redirect("books_list")
    else:
        formset = BookFormSet(queryset=Book.objects.all())

    return render(request, "edit_books.html", {"formset": formset})
```

* **`modelformset_factory`** создаёт класс формсета для модели `Book`.
* **`extra=0`** — не добавляем пустых форм, только существующие объекты.
* **`queryset=Book.objects.all()`** — набор объектов для редактирования.

---

## Ограничения

* **Нельзя** редактировать связанные объекты напрямую (только выбрать их в `ForeignKey`/`ManyToMany`).
* Для редактирования «детей» вместе с родителем нужен **InlineFormSet**.


## Дабы избежать путаницы: отличия `ModelFormSet` от `InlineFormSet`

### 1. InlineFormSet (в примере с автором)

Это пример предыдущей темы:

```python
BookFormSet = inlineformset_factory(
    Author,             # родительская модель
    Book,               # дочерняя модель (ForeignKey → Author)
    fields=['title', 'year_published', 'is_deleted'],
    extra=1,
    can_delete=True
)
```

### Как это работает

* Мы редактируем книги только ОДНОГО КОНКРЕТНОГО автора.
* На странице автора (`Author`) мы можем:

  * Изменить книги автора
  * Добавить новые книги
  * Удалить старые книги

То есть имеется иерархия **родитель → дети**.
`FormSet` привязан к одному автору, а не ко всем книгам сразу.

---

### 2. ModelFormSet

```python
BookFormSet = modelformset_factory(
    Book,
    fields=['title', 'year_published', 'author', 'is_deleted'],
    extra=0
)
```

#### Как это работает

* Мы редактируем книги БЕЗ ПРИВЯЗКИ к конкретному автору**.
* Можно менять:

  * Названия
  * Года издания
  * Принадлежность книги к автору (`ForeignKey` — просто как поле)
  * Флаг удаления

Нет родителя, просто массовое редактирование всей записей одной модели.

---

### Ещё раз "на зачёт" 

| Форма             | Привязка к родителю  | Что редактируем          | Когда использовать                                    | Функция для создания    |
| ----------------- | -------------------- | ------------------------ | ----------------------------------------------------- | ----------------------- |
| **InlineFormSet** | Есть (Author → Book) | Книги конкретного автора | Когда редактируем объекты, связанные с родителем      | `inlineformset_factory` |
| **ModelFormSet**  | Нет                  | Любые книги              | Когда нужно массово редактировать объекты всей модели | `modelformset_factory`  |



