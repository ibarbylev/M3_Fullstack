`QuerySet` ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ë–î –≤ Django.  

## üìå –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**`QuerySet`** ‚Äî —ç—Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é.  
–í Django –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ORM (Object-Relational Mapping), –ø–æ—ç—Ç–æ–º—É `QuerySet` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–∞–∫ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ Python.

---
## –ü—Ä–∏–º–µ—Ä
```python
from myapp.models import MyappModel

qs = MyappModel.objects.all()  # qs - —ç—Ç–æ –∏ –µ—Å—Ç—å QuerySet

print(qs)  
# <QuerySet [<MyappModel: default: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ –º–Ω–æ–π –ª–∏—á–Ω–æ>, <MyappModel: example 1: comment 1>, ...]>
```

–ü–æ —Å—É—Ç–∏, `QuerySet` - —ç—Ç–æ –¥–≤—É–º–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î, –≥–¥–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç - —Å—Ç—Ä–æ–∫–∞ —Ç–∞–±–ª–∏—Ü—ã.  
–ü—Ä–∞–≤–¥–∞, —Å–ø–∏—Å–æ–∫ —Å –Ω–µ—Å–∫–æ–ª—å–∫–æ "–Ω–µ–æ–±—ã—á–Ω—ã–º–∏" —Å–≤–æ–π—Å—Ç–≤–∞–º–∏.


---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `QuerySet` –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—ã—á–Ω—ã–º —Å–ø–∏—Å–∫–æ–º

| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ                           | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                             |
| -------------------------------------- |------------------------------------------------------------------------------------------------------|
| üîÑ **–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (lazy)**         | –ó–∞–ø—Ä–æ—Å –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `list`).        |
| üîç **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL**        | –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –≤ Python. –≠—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –∏ —ç–∫–æ–Ω–æ–º–Ω–µ–µ –ø–æ –ø–∞–º—è—Ç–∏. |
| üß± **–ö–æ–º–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å**                | –ú–æ–∂–Ω–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å `.filter()`, `.exclude()` –∏ –¥—Ä. ‚Äî Django —Å–æ–∑–¥–∞—ë—Ç –û–î–ò–ù(!) SQL-–∑–∞–ø—Ä–æ—Å. |
| ‚öôÔ∏è **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∫–∏**             | –ú–µ—Ç–æ–¥—ã `.select_related()` –∏ `.prefetch_related()` –ø–æ–∑–≤–æ–ª—è—é—Ç —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.      |
| üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**                    | Django ORM —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏.                                        |
| üõ† **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —à–∞–±–ª–æ–Ω–∞–º–∏**       | `QuerySet` –º–æ–∂–Ω–æ –ø—Ä—è–º–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ —à–∞–±–ª–æ–Ω—ã –∏ –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –∫–∞–∫ —Å–ø–∏—Å–æ–∫.                                 |
| üìä **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–π –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π** | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª—É—á–∞—Ç—å —Å—É–º–º—ã, —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏ –ø—Ä.                      |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã `QuerySet`

### üì§ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

| –ú–µ—Ç–æ–¥         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                            | –ü—Ä–∏–º–µ—Ä                                     |
| ------------- | ------------------------------------- | ------------------------------------------ |
| `.all()`      | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã                  | `Book.objects.all()`                       |
| `.get()`      | –ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç (–∏–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ) | `Book.objects.get(id=1)`                   |
| `.filter()`   | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è                            | `Book.objects.filter(year=2020)`           |
| `.exclude()`  | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ                            | `Book.objects.exclude(author='–ü—É—à–∫–∏–Ω')`    |
| `.order_by()` | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞                            | `Book.objects.order_by('-year')`           |
| `.distinct()` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è                   | `Book.objects.values('author').distinct()` |

---

### üéØ –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ —á–∞—Å—Ç–∏—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º

| –ú–µ—Ç–æ–¥            | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                      | –ü—Ä–∏–º–µ—Ä                                         |
| ---------------- |---------------------------------| ---------------------------------------------- |
| `.values()`      | –°–ª–æ–≤–∞—Ä–∏ –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–æ–≤         | `Book.objects.values('title', 'year')`         |
| `.values_list()` | –¢—é–ø–ª—ã –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–æ–≤           | `Book.objects.values_list('title', flat=True)` |
| `.only()`        | –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—è | `Book.objects.only('title')`                   |
| `.defer()`       | –û—Ç–ª–æ–∂–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø–æ–ª–µ–π         | `Book.objects.defer('description')`            |

---

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

| –ú–µ—Ç–æ–¥       | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ            | –ü—Ä–∏–º–µ—Ä                                             |
| ----------- | --------------------- | -------------------------------------------------- |
| `.update()` | –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ   | `Book.objects.filter(year=2020).update(year=2021)` |
| `.delete()` | –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ     | `Book.objects.filter(old=True).delete()`           |
| `.create()` | –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ | `Book.objects.create(title="–ú–∏—Ä", year=2022)`      |

---

### üìä –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥          | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   | –ü—Ä–∏–º–µ—Ä                                             |
| -------------- | ---------------------------- | -------------------------------------------------- |
| `.count()`     | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π           | `Book.objects.count()`                             |
| `.aggregate()` | –°—É–º–º—ã, —Å—Ä–µ–¥–Ω–∏–µ –∏ –¥—Ä.         | `Book.objects.aggregate(Avg('price'))`             |
| `.annotate()`  | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –ø–æ–ª–µ–π | `Author.objects.annotate(num_books=Count('book'))` |

---

### üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

| –ú–µ—Ç–æ–¥                 | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   | –ü—Ä–∏–º–µ—Ä                                     |
| --------------------- | ---------------------------- | ------------------------------------------ |
| `.select_related()`   | –ñ–∞–¥–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ ForeignKey   | `Book.objects.select_related('author')`    |
| `.prefetch_related()` | –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–µ–π many-to-many | `Author.objects.prefetch_related('books')` |



