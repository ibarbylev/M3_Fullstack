## ‚úÖ `Q` ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (AND, OR, NOT)

### üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `Q`

–ö–ª–∞—Å—Å `Q` –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã —Å **`&` (AND)**, **`|` (OR)**, **`~` (NOT)**;
* —Å—Ç—Ä–æ–∏—Ç—å —É—Å–ª–æ–≤–∏—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏**, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö;
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ `AND` –∏ `OR`**, —á–µ–≥–æ –Ω–µ–ª—å–∑—è –¥–æ—Å—Ç–∏—á—å –æ–±—ã—á–Ω—ã–º `.filter()` –±–µ–∑ `Q`.

### üß† –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```python
from django.db.models import Q

Q(—É—Å–ª–æ–≤–∏–µ1) & Q(—É—Å–ª–æ–≤–∏–µ2)   # AND
Q(—É—Å–ª–æ–≤–∏–µ1) | Q(—É—Å–ª–æ–≤–∏–µ2)   # OR
~Q(—É—Å–ª–æ–≤–∏–µ)                 # NOT
```

### üß™ –ü—Ä–∏–º–µ—Ä—ã

#### üîπ –ü—Ä–æ—Å—Ç–æ–µ `AND`:

```python
Book.objects.filter(Q(author='–ù–∏–∫–æ–ª–∞–π –ì–æ–≥–æ–ª—å') & Q(title='–ú—ë—Ä—Ç–≤—ã–µ –¥—É—à–∏'))
```
–ª–∏–±–æ

```python
Book.objects.filter(Q(author='–ù–∏–∫–æ–ª–∞–π –ì–æ–≥–æ–ª—å'), Q(title='–ú—ë—Ä—Ç–≤—ã–µ –¥—É—à–∏'))
```
#### üîπ –ü—Ä–æ—Å—Ç–æ–µ `OR`:

```python
# –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∏–º–µ–Ω–µ–º 'admin' –ò–õ–ò email 'test@example.com'
Book.objects.filter(Q(author='–ù–∏–∫–æ–ª–∞–π –ì–æ–≥–æ–ª—å') | Q(title='–ì–∞–º–ª–µ—Ç'))
```

#### üîπ –°–ª–æ–∂–Ω–æ–µ `AND + OR`:

```python
# –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –≤–æ–∑—Ä–∞—Å—Ç < 18 –ò–õ–ò > 65
Book.objects.filter(author='–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ü—É—à–∫–∏–Ω').filter(
    Q(title='–°—Ç–∞–Ω—Ü–∏–æ–Ω–Ω—ã–π —Å–º–æ—Ç—Ä–∏—Ç–µ–ª—å') | Q(title='–ï–≤–≥–µ–Ω–∏–π –û–Ω–µ–≥–∏–Ω')
)
```

#### üîπ –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ:

```python
# –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ù–ï –∞–∫—Ç–∏–≤–Ω—ã–µ
Book.objects.filter(~Q(author='–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ü—É—à–∫–∏–Ω'))
```

#### üîπ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `.exclude()`:

```python
# –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏–º–µ–Ω–µ–º admin –∏–ª–∏ moderator
Book.objects.exclude(Q(author__icontains='–ê–ª–µ–∫—Å–∞–Ω–¥—Ä') | Q(author__icontains='–ê–Ω—Ç–æ–Ω'))
```

#### üîπ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π:

–° –ø–æ–º–æ—â—å—é Q –∫–ª–∞—Å—Å–∞ –ª–µ–≥–∫–æ –∏ —É–¥–æ–±–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞–±–∏—Ä–∞—Ç—å —É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞.

```python
filters = Q()
if some_condition:
    filters &= Q(author__icontains='–ê–ª–µ–∫—Å–∞–Ω–¥—Ä')
if other_condition:
    filters |= Q(author__icontains='–ê–Ω—Ç–æ–Ω')

Book.objects.filter(filters)
```

#### –ü–æ—è—Å–Ω–µ–Ω–∏–µ –∫ –∫–æ–¥—É:

- `filters = Q()`
  - –°–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç Q, –∫–æ—Ç–æ—Ä—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω True (—Ñ–∏–ª—å—Ç—Ä –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π).

- `filters &= Q(author__icontains='–ê–ª–µ–∫—Å–∞–Ω–¥—Ä')`
  - –ï—Å–ª–∏ some_condition –∏—Å—Ç–∏–Ω–Ω–æ, —Ç–æ –º—ã –¥–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏–µ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º AND ‚Äî —Ç–µ–ø–µ—Ä—å filters –±—É–¥–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å:

- `filters |= Q(author__icontains='–ê–Ω—Ç–æ–Ω')`
  - –ï—Å–ª–∏ other_condition –∏—Å—Ç–∏–Ω–Ω–æ, —Ç–æ –º—ã –¥–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏–µ —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º OR ‚Äî —Ç–µ–ø–µ—Ä—å filters —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –∏ –æ–∑–Ω–∞—á–∞–µ—Ç:


–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ `some_condition = other_condition = True`,   
—Ç–æ —Ñ–∏–ª—å—Ç—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø—Ä–∏–º–µ—Ä:
```python
Q(author__icontains='–ê–ª–µ–∫—Å–∞–Ω–¥—Ä') | Q(author__icontains='–ê–Ω—Ç–æ–Ω')
```

---

## ‚úÖ `F` ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ **–ø–æ–ª—è —Å –ø–æ–ª–µ–º**

### üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `F`

`F` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö **–æ–¥–Ω–æ –ø–æ–ª–µ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º** –≤ —Ä–∞–º–∫–∞—Ö **–û–î–ù–û–ô** –∑–∞–ø–∏—Å–∏.

–ß–∞—â–µ –≤—Å–µ–≥–æ `F` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤**, **–¥–µ–∫—Ä–µ–º–µ–Ω—Ç–æ–≤** –∏ **–≤—ã—á–∏—Å–ª–µ–Ω–∏–π**.

### üß† –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```python
from django.db.models import F

F('–¥—Ä—É–≥–æ–µ_–ø–æ–ª–µ')
```

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã

#### üîπ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π:

```python
# –¢–æ–≤–∞—Ä—ã, –≥–¥–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ –º–µ–Ω—å—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–∫–∞–∑–æ–≤
Product.objects.filter(stock__lt=F('ordered'))
```

#### üîπ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–æ–≥–æ:

```python
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –Ω–∞ 1
User.objects.update(rating=F('rating') + 1)
```

#### üîπ –í—ã—á–∏—Ç–∞–Ω–∏–µ:

```python
# –£–º–µ–Ω—å—à–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ –Ω–∞ 5
Product.objects.update(stock=F('stock') - 5)
```

#### üîπ F –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö:

```python
# –î–∞–≤–∞–π—Ç–µ –¥–æ–±–∞–≤–∏–º –≥–æ–¥ –∏–∑–¥–∞–Ω–∏—è (), –≤—ã—á—Ç—è –æ–¥–∏–Ω –≥–æ–¥ –∏–∑ –¥–∞—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
books_with_year_written = Book.objects.annotate(
    year_written=F('year_published') - 1
)
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î, –Ω–æ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ü–∏–∫–ª–µ

---

## üÜö `Q` vs `F` ‚Äî –≤ —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞?

|                | `Q`                                   | `F`                                  |
| -------------- |---------------------------------------|--------------------------------------|
| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ     | –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è                  | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ       |
| –ü—Ä–∏–º–µ—Ä         | `Q(age__lt=18) \| Q(is_active=False)` | `F('stock') < F('ordered')`          |
| –ê–Ω–∞–ª–æ–≥ –≤ SQL   | WHERE + –ª–æ–≥–∏–∫–∞                        | `WHERE field1 < field2`              |


