## Особенности и нюансы

### 1. Сообщения одноразовые

* Сообщения хранятся **только до следующего запроса–ответа**.
* После того как они были выведены в шаблоне, Django автоматически удаляет их из хранилища.
* То есть сообщение нельзя показать дважды без повторного добавления через `messages.add_message()`.

**Пример:**

```python
messages.success(request, "Эта информация будет показана только один раз")
```

* При повторном рендеринге без повторного добавления оно исчезнет.

---

### 2. Хранение сообщений в сессии

* Если используется `SessionStorage`, сообщения сохраняются в сессии пользователя.
* После отображения они автоматически удаляются, но иногда нужно  
  явно очистить или удалить сообщения, например при кастомной логике:

```python
# очистка всех сообщений
list(messages.get_messages(request))  # прочтение сообщений очищает их из хранилища
```

* Важно учитывать, что сессии могут быть большие, поэтому не стоит хранить  
  слишком длинные тексты сообщений.

---

### 3. Работа с AJAX

При AJAX-запросах стандартный рендер шаблона не происходит,  
поэтому сообщения **не отображаются автоматически**.

**Варианты работы:**

#### a) Отправка сообщений через JSON

Во view можно собрать все сообщения и вернуть их как JSON:

```python
from django.http import JsonResponse
from django.contrib import messages

def ajax_view(request):
    messages.success(request, "Данные успешно сохранены")
    messages.error(request, "Произошла ошибка при обработке")
    
    # собираем все сообщения
    message_list = []
    for message in messages.get_messages(request):
        message_list.append({
            "level": message.level,
            "tags": message.tags,
            "text": message.message,
        })
    
    return JsonResponse({"messages": message_list})
```

#### b) Отображение на фронтенде

* JS получает JSON с сообщениями и динамически вставляет их в DOM.
* Можно использовать те же CSS-классы, что и для обычных сообщений.

**Пример на JS (jQuery):**

```javascript
$.post("/ajax-url/", data, function(response) {
    response.messages.forEach(msg => {
        $("#messages").append(
            `<div class="alert alert-${msg.tags}">${msg.text}</div>`
        );
    });
});
```

* Так сообщения будут видны пользователю без перезагрузки страницы.
