# Проверка покрытия тестами бизнес логики


## 1 Установке пакета`pytest-cov`


```bash
pip install pytest-cov
```

## 2 Запуск с отчетом по покрытию:

```bash
pytest --cov=user --cov=shop --cov-report=term-missing
```

* `--cov=user` и `--cov=shop` — измеряем покрытие для этих приложений
* `--cov-report=term-missing` — показывает линии, которые **не покрыты тестами**

> После этого мы увидим процент покрытия и сможем убедиться, что тестами проверены все важные методы бизнес-логики.

После запуска команды должно быть что-то вроде этого:

```
============================================================== tests coverage ===============================================================
_____________________________________________ coverage: platform linux, python 3.12.10-final-0 ______________________________________________

Name                                  Stmts   Miss  Cover   Missing
-------------------------------------------------------------------
shop/__init__.py                          0      0   100%
shop/admin.py                             1      0   100%
shop/apps.py                              4      0   100%
shop/migrations/0001_initial.py           7      0   100%
shop/migrations/__init__.py               0      0   100%
shop/models.py                          126      6    95%   83-84, 96, 128, 155, 212
shop/tests/__init__.py                    0      0   100%
shop/tests/test_order.py                 29      0   100%
shop/tests/test_payment.py               38      0   100%
shop/tests/test_product.py               26      0   100%
shop/tests/test_review.py                27      0   100%
shop/tests/test_signals_and_jobs.py      60      0   100%
shop/views.py                             1      1     0%   1
user/__init__.py                          0      0   100%
user/admin.py                             1      0   100%
user/apps.py                              4      0   100%
user/migrations/0001_initial.py           7      0   100%
user/migrations/__init__.py               0      0   100%
user/models.py                           60      3    95%   80-82
user/tests/__init__.py                    0      0   100%
user/tests/test_user_profile.py          47      0   100%
user/tests/test_user_token.py            34      0   100%
user/views.py                             1      1     0%   1
-------------------------------------------------------------------
TOTAL                                   473     11    98%
============================================================ 32 passed in 21.17s ============================================================

```

То есть в `shop/models.py` ни один тест ни разу "не прошёлся" по строкам: 83-84, 96, 128, 155, 212

---

## 3 Рекомендации

1. **Сначала проверяем модели**, как мы сделали.
2. После этого можно добавить тесты **API и форм** с использованием фикстуры `client` Django.
3. Постепенно расширяем тесты для **нестандартных сценариев**: например, 
   * добавление нескольких товаров, 
   * edge-case для токенов, 
   * проверка ошибок оплаты и т.д.



