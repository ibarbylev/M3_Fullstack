# Примерная схема Базы Данных проекта

## Приложение `user`

### 1 UserProfile — Дополнения к пользователю

| Поле       | Тип            | PK/FK/Уникальность        | Описание              |
|------------|----------------| ------------------------- |-----------------------|
| id         | INT            | PK                        | Первичный ключ        |
| user_id    | INT            | FK → auth_user.id, UNIQUE | Связь с пользователем |
| phone      | VARCHAR(20)    |                           | Телефон               |
| address    | VARCHAR(255)   |                           | Адрес доставки        |
| avatar     | VARCHAR(255)   |                           | Фото профиля          |
| balance    | DECIMAL(10, 2) |                           | Баланс пользователя   |
| created_at | TIMESTAMP      |                           | Дата создания         |
| updated_at | TIMESTAMP      |                           | Дата изменения        |

---

### 2 UserToken — Токены пользователей

| Поле       | Тип          | PK/FK/Уникальность | Описание                                            |
| ---------- | ------------ | ------------------ | --------------------------------------------------- |
| id         | INT          | PK                 | Первичный ключ                                      |
| user_id    | INT          | FK → auth_user.id  | Пользователь                                        |
| token      | VARCHAR(255) | UNIQUE             | Токен (JWT или случайная строка)                    |
| token_type | ENUM         |                    | Тип токена: refresh / password_reset / email_verify |
| expires_at | TIMESTAMP    |                    | Время истечения токена                              |
| created_at | TIMESTAMP    |                    | Дата создания                                       |
| revoked    | BOOLEAN      |                    | Флаг отзыва токена (неактивный)                     |


Удобнее всего использовать **одну таблицу `UserToken`** для всех типов токенов: 
* и для JWT, 
* и для подтверждения email, 
* и для сброса пароля. 

Главное — добавить **тип токена** (`token_type`) и время жизни (`expires_at`).

Пояснение:

1. **Тип токена** (`token_type`)

   * `refresh` — для обновления JWT
   * `access` — (опционально) короткоживущий JWT, если храним серверно
   * `email_verify` — для подтверждения email
   * `password_reset` — для сброса пароля

2. **Время жизни** (`expires_at`)

   * Для JWT refresh токена может быть несколько дней/недель
   * Для email-подтверждения обычно несколько часов
   * Для сброса пароля — ограниченное время (1–2 часа)

3. **Флаг `revoked`**

   * Позволяет пометить токен как недействительный без удаления записи


---
---

## Приложение `shop`

### 3 Category — Категории товаров

| Поле       | Тип          | PK/FK/Уникальность | Описание                     |
| ---------- | ------------ | ------------------ | ---------------------------- |
| id         | INT          | PK                 | Первичный ключ               |
| name       | VARCHAR(255) |                    | Название категории           |
| slug       | VARCHAR(255) | UNIQUE             | ЧПУ/уникальный идентификатор |
| created_at | TIMESTAMP    |                    | Дата создания                |
| updated_at | TIMESTAMP    |                    | Дата изменения               |


---

### 4 Product — Товары

| Поле        | Тип           | PK/FK/Уникальность | Описание                          |
| ----------- | ------------- | ------------------ | --------------------------------- |
| id          | INT           | PK                 | Первичный ключ                    |
| name        | VARCHAR(255)  |                    | Название товара                   |
| slug        | VARCHAR(255)  | UNIQUE             | ЧПУ/уникальный идентификатор      |
| description | TEXT          |                    | Описание товара                   |
| price       | DECIMAL(10,2) |                    | Цена товара                       |
| unit        | VARCHAR(50)   |                    | Единица измерения (шт, кг и т.п.) |
| category_id | INT           | FK → Category.id   | Категория товара                  |
| image       | VARCHAR(255)  |                    | Основное изображение              |
| specs       | JSON          |                    | Характеристики товара             |
| is_active   | BOOLEAN       |                    | Активность товара                 |
| stock       | INT           |                    | Количество на складе              |
| created_at  | TIMESTAMP     |                    | Дата создания                     |
| updated_at  | TIMESTAMP     |                    | Дата изменения                    |

---


### 5 Order — Заказы

| Поле           | Тип           | PK/FK/Уникальность | Описание                                  |
|----------------|---------------|--------------------|-------------------------------------------|
| id             | INT           | PK                 | Первичный ключ                            |
| user_id        | INT           | FK → auth_user.id  | Пользователь                              |
| order_id       | VARCHAR(25)   |                    | Номер заказа (`yyyymmdd_hhmmss_user_id`)  |
| status         | ENUM          |                    | `pending/paid/shipped/delivered/cancelled` |
| total_price    | DECIMAL(10,2) |                    | Общая сумма заказа                        |
| invoice_number | INT           |                    | Номер инвойса                             |
| created_at     | TIMESTAMP     |                    | Дата создания                             |
| updated_at     | TIMESTAMP     |                    | Дата изменения                            |

---

### 6 OrderItem — Элементы заказа

| Поле       | Тип           | PK/FK/Уникальность | Описание              |
| ---------- | ------------- | ------------------ |-----------------------|
| id         | INT           | PK                 | Первичный ключ        |
| order_id   | INT           | FK → Order.id      | Заказ                 |
| product_id | INT           | FK → Product.id    | Товар                 |
| quantity   | INT           |                    | Количество            |
| price      | DECIMAL(10,2) |                    | Цена на момент заказа |

---

### 7 Review — Отзывы

| Поле       | Тип       | PK/FK/Уникальность | Описание       |
| ---------- | --------- | ------------------ | -------------- |
| id         | INT       | PK                 | Первичный ключ |
| product_id | INT       | FK → Product.id    | Товар          |
| user_id    | INT       | FK → auth_user.id  | Автор          |
| rating     | TINYINT   |                    | 1–5            |
| comment    | TEXT      |                    | Текст отзыва   |
| created_at | TIMESTAMP |                    | Дата создания  |


---

### 8 Payment — Оплаты

| Поле           | Тип           | PK/FK/Уникальность | Описание                           |
| -------------- | ------------- | ------------------ | ---------------------------------- |
| id             | INT           | PK                 | Первичный ключ                     |
| order_id       | INT           | FK → Order.id      | Заказ                              |
| amount         | DECIMAL(10,2) |                    | Сумма оплаты                       |
| status         | ENUM          |                    | pending/completed/failed/cancelled |
| payment_method | VARCHAR(50)   |                    | Метод оплаты                       |
| transaction_id | VARCHAR(255)  |                    | Идентификатор транзакции           |
| created_at     | TIMESTAMP     |                    | Дата создания                      |
| updated_at     | TIMESTAMP     |                    | Дата изменения                     |


