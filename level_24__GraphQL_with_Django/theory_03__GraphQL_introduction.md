## 1. Введение в GraphQL

### 1.1 Что такое GraphQL

Итак, GraphQL — это язык запросов к API. Его главное отличие от REST:

| Особенность                     | REST                                                  | GraphQL                                                       |
| ------------------------------- | ----------------------------------------------------- | ------------------------------------------------------------- |
| Получение данных                | Каждый endpoint возвращает фиксированный набор данных | Один endpoint возвращает только те поля, которые запрашиваете |
| Избыточность                    | Часто получаем лишние данные                          | Получаем ровно то, что нужно                                  |
| Подключение нескольких ресурсов | Несколько запросов к разным endpoint                  | Один запрос может объединять несколько связанных сущностей    |
| Версионирование                 | Обычно новые версии API                               | Обычно версия API не нужна, поля добавляются в схему          |

---

### 1.2 Основные понятия GraphQL

1. **Schema (Схема)** — описание структуры API: какие типы есть и какие поля доступны.
   В вашем проекте это будут модели `Book`, `Author`, `BookDetail`, `Genre`.

2. **Query (Запрос)** — получение данных. Пример на вашем проекте:

```graphql
query {
  allBooks {
    id
    title
    author {
      name
    }
    detail {
      summary
      pageCount
    }
  }
}
```

* `allBooks` — поле Query.
* `author` и `detail` — связи моделей (ForeignKey / OneToOne).
* Мы получаем ровно те поля, которые нужны: `id`, `title`, имя автора, детали книги.

3. **Mutation (Мутация)** — изменение данных (создание, обновление, удаление).
   Пример (создание книги):

```graphql
mutation {
  createBook(
    title: "Новая книга", 
    authorId: 1, 
    yearPublished: 2025, 
    summary: "Краткое описание", 
    pageCount: 120
  ) {
    book {
      id
      title
      author {
        name
      }
    }
  }
}
```

4. **Field (Поле)** — конкретное свойство модели: `title`, `yearPublished`, `isDeleted`.
5. **Arguments (Аргументы)** — позволяют фильтровать или передавать данные: `id`, `authorId`.
6. **Type (Тип)** — структура данных, например:

```graphql
type Book {
  id: Int
  title: String
  author: Author
  detail: BookDetail
  genres: [Genre]
}
```

---

### 1.3 Принцип работы

1. Клиент отправляет **один запрос** на `/graphql/`.
2. Сервер смотрит на **схему**, проверяет, что запрашиваемые поля существуют.
3. Сервер возвращает JSON с **точно запрошенными данными**, включая связи моделей.

Пример ответа на запрос `allBooks`:

```json
{
  "data": {
    "allBooks": [
      {
        "id": 1,
        "title": "Война и мир",
        "author": {
          "name": "Лев Толстой"
        },
        "detail": {
          "summary": "Эпический роман",
          "pageCount": 1200
        }
      }
    ]
  }
}
```

---

### 1.4 Что GraphQL изменит на нашем сайте?

* Сейчас существуют отдельные CBV и формы для книг и авторов.
* DRF давал возможность одновременно получать и книги, и авторов, но: 
  * Приходилось создавать отдельные эндпойнты и сериализаторы для каждой связанной модели
  * Запрос возвращал избыточный объём информации

* GraphQL позволит:

  * Получать данные о книгах + авторах + деталях одной командой.
  * Получать только нужные поля, например только названия книг и авторов.
  * Обновлять книги и авторов через один запрос (мутация), без отдельных форм.

